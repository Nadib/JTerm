var ShellUI=function(e,t,n){void 0===n&&(n={}),void 0===n.prefix&&(n.prefix="$"),void 0===n.highlightColor&&(n.highlightColor="#a5a5a5"),this.options=n,this.inputElement=e,this.outputElement=t,this.endlineElement=null,this.prefixElement=null,this.keyboardSelected=null,this.currentHistory=null,this.commandHistory=[],this.commands={},this.preventPaste=!1,this.controlPressed=!1,this.eventListeners={},this.language=navigator.language,this.defaultLanguage="en",this.messages={command_not_found:{af:"Opdrag nie gevind nie",ar:"القيادة لم يتم العثور",az:"Əmr tapılmadı",be:"каманда не знойдзена",bg:"командата не е намерена",bn:"কমান্ড পাওয়া যায় নি",bs:"Naredba nije pronađena",ca:"Comanda no trobada",co:"Cumanda micca trovu",cs:"příkaz nenalezen",cy:"Gorchymyn heb ei ddarganfod",da:"Kommando ikke fundet",de:"befehl nicht gefunden",el:"Εντολή δεν βρέθηκε",en:"command not found",eo:"Komando ne trovita",es:"comando no encontrado",et:"käsklust ei leitud",fa:"فرمان یافت نشد",fi:"komentoa ei löydy",fr:"commande non trouvée",fy:"Kommando net fûn",ga:"Ordú nár aimsíodh",gd:"Òrdugh gun lorg",gl:"Comando non atopado",gu:"આદેશ મળી નથી",ha:"Umurnin ba a samu ba",haw:"'a'ole i loa'a ka papa",hi:"आदेश नहीं मिला",hmn:"Txib tsis pom",ht:"Kòmandman pa jwenn",hu:"Parancs nem található",hy:"Հրաման չի գտնվել",id:"perintah tidak ditemukan",ig:"Iwu achọtaghị",is:"Stjórn fannst ekki",it:"comando non trovato",iw:"פקודה לא נמצאה",ja:"コマンドが見つかりません",jw:"Printah ora ditemokake",ka:"ბრძანება ვერ მოიძებნა",kk:"Команда табылмады",km:"ពាក្យបញ្ជាមិនត្រូវបានរកឃើញ",kn:"ಆದೇಶ ಕಂಡುಬಂದಿಲ್ಲ",ko:"명령어를 찾을수 없음",ku:"Ferman nedît",ky:"буйрук табылган жок",lb:"Kommando net fonnt",lo:"ຄໍາສັ່ງບໍ່ພົບ",lt:"komanda nerasta",lv:"Komanda nav atrasta",mg:"Baiko tsy hita",mi:"Kaore i kitea",mk:"Командата не е пронајдена",ml:"ആജ്ഞ കണ്ടെത്തിയില്ല",mn:"Тушаал олдсонгүй",mr:"आदेश आढळला नाही",ms:"Arahan tidak dijumpai",mt:"Kmand ma nstabx",my:"command ကိုမတွေ့ရှိ",ne:"आदेश फेला परेन",nl:"opdracht niet gevonden",no:"kommando ikke funnet",pa:"ਕਮਾਂਡ ਨਹੀਂ ਮਿਲੀ",pl:"nie znaleziono polecenia",ps:"کمانډ ونه موندل شو",pt:"comando não encontrado",ro:"comanda nu a fost găsită",ru:"команда не найдена",sd:"حڪم نه مليو",si:"විධානය සොයාගත නොහැකි",sk:"príkaz nenájdený",sl:"Ukaz ni bil najden",sq:"komanda nuk u gjet",sm:"Poloaiga e le maua",sn:"Raira isingawaniki",so:"Amar ma helin",sr:"Команда није пронађена",su:"paréntah teu kapendak",st:"Taelo e sa fumanoeng",sv:"Kommando inte hittat",sw:"Amri haipatikani",ta:"கட்டளை காணப்படவில்லை",te:"కమాండ్ కనుగొనబడలేద",tg:"Фармоиш ёфт нашуд",th:"ไม่พบคำสั่ง",tl:"Hindi nakita ang utos",tr:"komut bulunamadı",uk:"Команди не знайдено",ur:"کمانڈ نہیں ملا",uz:"Buyruqlar topilmadi",vi:"lệnh không tìm thấy",xh:"Umyalelo awufumanekanga",yo:"Aṣẹ ko ri",zh:"找不到命令","zh-TW":"找不到命令",zu:"Umyalo awutholakali"}},this.init=function(){this.inputElement=document.getElementById(this.inputElement),this.inputElement.style["white-space"]="pre",document.addEventListener("paste",this.pasteText.bind(this)),this.outputElement=document.getElementById(this.outputElement),this.outputElement.style["white-space"]="pre",this.endlineElement=this.createElement("span"," "),this.endlineElement.style["background-color"]=this.options.highlightColor,this.endlineElement.style["white-space"]="pre",this.inputElement.parentElement.insertBefore(this.endlineElement,this.inputElement.nextSibling),this.prefixElement=this.createElement("span",this.options.prefix+" "),this.inputElement.parentElement.insertBefore(this.prefixElement,this.inputElement),document.addEventListener("keypress",this.keyboardCallback.bind(this)),document.addEventListener("keydown",this.keyboardInteraction.bind(this)),document.addEventListener("keyup",this.keyboardUp.bind(this)),this.addEventListener("commandComplete",this.commandComplete.bind(this)),this.addCommand("help",this.helpCommand.bind(this))},this.helpCommand=function(e){var t="";if(void 0===e){t="List of commands available : \r\n\r\n";for(var n in this.commands)"help"!==n&&(t+=" - "+this.commands[n].getHelp(!0)+"\r\n");t+="\r\n Type help [command] to get help from more specific command"}else e&&(void 0===this.commands[e]?t+=e+" : "+this.getMessage("command_not_found"):t+=this.commands[e].getHelp());return t},this.getMessage=function(e,t){if(this.messages[e])return void 0===t&&(t=this.language),this.messages[e][t]?this.messages[e][t]:this.messages[e][this.defaultLanguage]?this.messages[e][this.defaultLanguage]:void 0},this.removeEventListener=function(e,t){if(this.eventListeners[e]){var n;for(n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]===t){this.eventListeners[e].splice(n,1);break}}},this.addEventListener=function(e,t){this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},this.dispatchEvent=function(e){if(this.eventListeners[e.name]){var t;for(e.target=this,t=0;t<this.eventListeners[e.name].length;t++)this.eventListeners[e.name][t].apply(this,[e])}},this.pasteText=function(e){var t,n=e.clipboardData.getData("text"),i=this.inputElement.textContent,s="";for(t=0;t<n.length;t++)s+="<span>"+n[t]+"</span>";if(null!==this.keyboardSelected){var a="";for(t=0;t<i.length;t++)t===this.keyboardSelected&&(a+=s),a+="<span>"+i[t]+"</span>";this.inputElement.innerHTML=a,this.keyboardSelected=this.keyboardSelected+n.length}else this.inputElement.innerHTML+=s},this.addCommand=function(e,t,n){this.commands[e]=new ShellUICommand(e,t,this,n)},this.executeCommand=function(e){var t=e.split(/[ ]+/),n=t[0],arguments=t.slice(1);this.commands[n]?(this.prefixElement.style.display="none",this.commands[n].execute(arguments)):this.printOutput("-ShellUI: "+n+": "+this.getMessage("command_not_found")),this.currentHistory=null},this.commandComplete=function(e){e.options.returnContent&&this.printOutput(e.options.returnContent),this.resetInput(),this.prefixElement.style.display="inline"},this.resetInput=function(){for(this.selectChar(null);this.inputElement.firstChild;)this.inputElement.removeChild(this.inputElement.firstChild)},this.createElement=function(e,t){var n=document.createElement(e),i=document.createTextNode(t);return n.appendChild(i),n},this.keyboardCallback=function(e){switch(e.keyCode){case 8:case 37:case 39:case 38:case 40:break;case 13:var t=this.inputElement.textContent;this.printOutput(this.prefixElement.textContent+t),this.resetInput(),t&&(this.commandHistory.push(t),this.executeCommand(t));break;default:if(!e.key){var n=String.fromCharCode(e.keyCode);e.shiftKey||(n=n.toLowerCase()),e.key=n}if(!1===this.preventPaste){if(!0===this.controlPressed&&("c"===e.key||3===e.keyCode)){this.resetInput();var i=new ShellUIEvent("cancel",{});return void this.dispatchEvent(i)}null!==this.keyboardSelected?(this.inputElement.insertBefore(this.createElement("span",e.key),this.inputElement.children[this.keyboardSelected]),this.selectChar(this.keyboardSelected+1)):this.inputElement.append(this.createElement("span",e.key))}}},this.printOutput=function(e){this.outputElement.appendChild(this.createElement("p",e))},this.removeChar=function(e){-1===e&&(e=this.inputElement.children.length-1),this.inputElement.children[e]&&this.inputElement.removeChild(this.inputElement.children[e])},this.selectChar=function(e){null!==this.keyboardSelected&&this.inputElement.children[this.keyboardSelected]&&(this.inputElement.children[this.keyboardSelected].style["background-color"]="transparent"),this.keyboardSelected=e,null!==this.keyboardSelected&&this.inputElement.children[this.keyboardSelected]?(this.endlineElement.style.display="none",this.inputElement.children[this.keyboardSelected].style["background-color"]=this.options.highlightColor):this.endlineElement.style.display="inline"},this.repeatCommand=function(e){if(this.currentHistory=e,this.commandHistory[this.currentHistory]){this.resetInput();var t;for(t=0;t<this.commandHistory[this.currentHistory].length;t++)this.inputElement.appendChild(this.createElement("span",this.commandHistory[this.currentHistory][t]))}},this.selectFromKeyboard=function(e){length=this.inputElement.children.length,length>0&&("left"===e?null===this.keyboardSelected?this.selectChar(length-1):this.keyboardSelected>0&&this.selectChar(this.keyboardSelected-1):"right"===e&&(null!==this.keyboardSelected&&this.keyboardSelected<length-1?this.selectChar(this.keyboardSelected+1):this.selectChar(null)))},this.selectCommandFromHistory=function(e){length=this.commandHistory.length,length>0&&("top"===e?null===this.currentHistory?this.repeatCommand(length-1):this.currentHistory>0&&this.repeatCommand(this.currentHistory-1):"bottom"===e&&(null!==this.currentHistory&&this.currentHistory<length-1?this.repeatCommand(this.currentHistory+1):this.repeatCommand(null)))},this.keyboardUp=function(e){"Control"!=e.keyIdentifier&&"Control"!==e.key?(e.keyIdentifier&&"Meta"===e.keyIdentifier||e.key&&"Meta"===e.key)&&(this.preventPaste=!1):this.controlPressed=!1},this.keyboardInteraction=function(e){if(e.keyIdentifier&&"Meta"===e.keyIdentifier||e.key&&"Meta"===e.key)this.preventPaste=!0;else if("Control"!=e.keyIdentifier&&"Control"!==e.key)switch(e.keyCode){case 8:null!==this.keyboardSelected?this.keyboardSelected>0&&(this.removeChar(this.keyboardSelected-1),this.selectChar(this.keyboardSelected-1)):this.removeChar(-1);break;case 37:this.selectFromKeyboard("left");break;case 39:this.selectFromKeyboard("right");break;case 38:this.selectCommandFromHistory("top");break;case 40:this.selectCommandFromHistory("bottom")}else this.controlPressed=!0},"complete"===document.readyState?this.init():document.addEventListener("DOMContentLoaded",this.init.bind(this))},ShellUICommand=function(e,t,n,i){void 0===i&&(i={}),this.name=e,this.callback=t,this.shell=n,this.options=i,this.signature=null,this.cancel=!1,this.execute=function(arguments){this.cancel=!1,this.shell.removeEventListener("cancel",this.cancelBound),this.shell.addEventListener("cancel",this.cancelBound),!0===this.options.async?this.callback.apply(this,arguments):this.endCommand(this.callback.apply(this,arguments))},this.getSignature=function(){if(null===this.signature){var e=this.callback.toString().replace(/[\r\n\s]+/g," ").match(/function\s*\w*\s*\((.*?)\)/)[1].split(/\s*,\s*/);this.signature=this.name;var t;for(t=0;t<e.length;t++)this.signature+=" ["+e[t]+"]"}return this.signature},this.endCommand=function(e){if(!1===this.cancel){var t=new ShellUIEvent("commandComplete",{returnContent:e,command:this});this.shell.dispatchEvent(t)}},this.getHelp=function(e){var t=this.getSignature();return this.options.summary&&(t+=" "+this.options.summary),!0===e?t:(this.options.help&&(t+=" \r\n"+this.options.help),t)},this.cancelCallback=function(e){this.cancel=!0;var t=new ShellUIEvent("commandComplete",{returnContent:void 0,command:this});this.shell.dispatchEvent(t)},this.cancelBound=this.cancelCallback.bind(this)},ShellUIEvent=function(e,t){this.name=e,this.options=t,this.target=null};
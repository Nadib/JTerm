var ShellUI=function(e,t,i,n){this.inputElement=e,this.outputElement=t,this.endlineElement=i,this.prefixElement=n,this.keyboardSelected=null,this.currentHistory=null,this.commandHistory=[],this.commands={},this.preventPaste=!1,this.controlPressed=!1,this.init=function(){this.inputElement=document.getElementById(this.inputElement),this.inputElement.style["white-space"]="pre",document.addEventListener("paste",this.pasteText.bind(this)),this.endlineElement&&(this.endlineElement=document.getElementById(this.endlineElement)),this.outputElement&&(this.outputElement=document.getElementById(this.outputElement),this.outputElement.style["white-space"]="pre"),this.prefixElement&&(this.prefixElement=document.getElementById(this.prefixElement)),document.addEventListener("keypress",this.keyboardCallback.bind(this)),document.addEventListener("keydown",this.keyboardInteraction.bind(this)),document.addEventListener("commandComplete",this.commandComplete.bind(this))},this.pasteText=function(e){var t,i=e.clipboardData.getData("text"),n=this.inputElement.textContent,s="";for(t=0;t<i.length;t++)s+="<span>"+i[t]+"</span>";if(null!==this.keyboardSelected){var h="";for(t=0;t<n.length;t++)t===this.keyboardSelected&&(h+=s),h+="<span>"+n[t]+"</span>";this.inputElement.innerHTML=h,this.keyboardSelected=this.keyboardSelected+i.length}else this.inputElement.innerHTML+=s},this.addCommand=function(e,t,i){this.commands[e]=new ShellUICommand(e,t,i)},this.executeCommand=function(e){var t=e.split(/[ ]+/),i=t[0],arguments=t.slice(1);this.commands[i]?(this.prefixElement&&(this.prefixElement.style.display="none"),this.commands[i].execute(arguments)):this.printOutput("-ShellUI: "+i+": command not found")},this.commandComplete=function(e){e.detail&&e.detail.returnContent&&this.printOutput(e.detail.returnContent),this.resetInput(),this.prefixElement&&(this.prefixElement.style.display="inline")},this.resetInput=function(){for(this.selectChar(null);this.inputElement.firstChild;)this.inputElement.removeChild(this.inputElement.firstChild)},this.createElement=function(e,t){var i=document.createElement(e),n=document.createTextNode(t);return i.appendChild(n),i},this.keyboardCallback=function(e){switch(e.keyCode){case 8:case 37:case 39:case 38:case 40:break;case 13:var t=this.inputElement.textContent;if(this.outputElement){var i="";this.prefixElement&&(i+=this.prefixElement.textContent),i+=t,this.printOutput(i),this.resetInput()}t&&(this.commandHistory.push(t),this.executeCommand(t));break;default:if(!e.key){var n=String.fromCharCode(e.keyCode);e.shiftKey||(n=n.toLowerCase()),e.key=n}if(!1===this.preventPaste){if(!0===this.controlPressed&&3===e.keyCode)return this.resetInput(),void this.controlPressed;null!==this.keyboardSelected?(this.inputElement.insertBefore(this.createElement("span",e.key),this.inputElement.children[this.keyboardSelected]),this.selectChar(this.keyboardSelected+1)):this.inputElement.append(this.createElement("span",e.key))}}this.preventPaste=!1},this.printOutput=function(e){this.outputElement.appendChild(this.createElement("p",e))},this.removeChar=function(e){-1===e&&(e=this.inputElement.children.length-1),this.inputElement.children[e]&&this.inputElement.removeChild(this.inputElement.children[e])},this.selectChar=function(e){null!==this.keyboardSelected&&this.inputElement.children[this.keyboardSelected]&&this.inputElement.children[this.keyboardSelected].classList.remove("shellui-highlight"),this.keyboardSelected=e,null!==this.keyboardSelected&&this.inputElement.children[this.keyboardSelected]?(this.endlineElement.style.display="none",this.inputElement.children[this.keyboardSelected].classList.add("shellui-highlight")):this.endlineElement.style.display="inline"},this.repeatCommand=function(e){if(this.currentHistory=e,this.commandHistory[this.currentHistory]){this.resetInput();var t;for(t=0;t<this.commandHistory[this.currentHistory].length;t++)this.inputElement.appendChild(this.createElement("span",this.commandHistory[this.currentHistory][t]))}},this.selectFromKeyboard=function(e){length=this.inputElement.children.length,length>0&&("left"===e?null===this.keyboardSelected?this.selectChar(length-1):this.keyboardSelected>0&&this.selectChar(this.keyboardSelected-1):"right"===e&&(null!==this.keyboardSelected&&this.keyboardSelected<length-1?this.selectChar(this.keyboardSelected+1):this.selectChar(null)))},this.selectCommandFromHistory=function(e){length=this.commandHistory.length,length>0&&("top"===e?null===this.currentHistory?this.repeatCommand(length-1):this.currentHistory>0&&this.repeatCommand(this.currentHistory-1):"bottom"===e&&(null!==this.currentHistory&&this.currentHistory<length-1?this.repeatCommand(this.currentHistory+1):this.repeatCommand(null)))},this.keyboardInteraction=function(e){if(e.keyIdentifier&&"Meta"===e.keyIdentifier)this.preventPaste=!0;else if("Control"!=e.keyIdentifier&&"Control"!==e.key)switch(e.keyCode){case 8:null!==this.keyboardSelected?this.keyboardSelected>0&&(this.removeChar(this.keyboardSelected-1),this.selectChar(this.keyboardSelected-1)):this.removeChar(-1);break;case 37:this.selectFromKeyboard("left");break;case 39:this.selectFromKeyboard("right");break;case 38:this.selectCommandFromHistory("top");break;case 40:this.selectCommandFromHistory("bottom")}else this.controlPressed=!0},"complete"===document.readyState?this.init():document.addEventListener("DOMContentLoaded",this.init.bind(this))},ShellUICommand=function(e,t,i){this.name=e,this.callback=t,this.options=i,void 0===this.options&&(this.options={}),this.execute=function(arguments){if(!0===this.options.async)this.callback.apply(this,arguments);else{var e=new CustomEvent("commandComplete",{detail:{returnContent:this.callback.apply(this,arguments)}});document.dispatchEvent(e)}}};
var ShellUI=function(t,e,i,n){this.inputElement=t,this.outputElement=e,this.endlineElement=i,this.prefixElement=n,this.keyboardSelected=null,this.currentHistory=null,this.commandHistory=[],this.commands={},this.commandBound=null,this.init=function(){this.inputElement=document.getElementById(this.inputElement),this.inputElement.style="white-space:pre;",this.endlineElement&&(this.endlineElement=document.getElementById(this.endlineElement)),this.outputElement&&(this.outputElement=document.getElementById(this.outputElement),this.outputElement.style="white-space:pre;"),this.prefixElement&&(this.prefixElement=document.getElementById(this.prefixElement)),document.addEventListener("keypress",this.keyboardCallback.bind(this)),document.addEventListener("keydown",this.keyboardInteraction.bind(this)),document.addEventListener("commandComplete",this.commandComplete.bind(this))},this.addCommand=function(t,e,i){this.commands[t]=new ShellUICommand(t,e,i)},this.executeCommand=function(t){var e=t.split(/[ ]+/),i=e[0],arguments=e.slice(1);this.commands[i]?(this.prefixElement&&(this.prefixElement.style="display:none"),this.commands[i].execute(arguments)):this.printOutput("-ShellUI: "+i+": command not found")},this.commandComplete=function(t){t.detail&&t.detail.returnContent&&this.printOutput(t.detail.returnContent),this.resetInput(),this.prefixElement&&(this.prefixElement.style="display:auto")},this.resetInput=function(){for(this.selectChar(null);this.inputElement.firstChild;)this.inputElement.removeChild(this.inputElement.firstChild)},this.createElement=function(t,e){var i=document.createElement(t),n=document.createTextNode(e);return i.appendChild(n),i},this.keyboardCallback=function(t){if(t.key)if("Enter"!=t.key)null!==this.keyboardSelected?(this.inputElement.insertBefore(this.createElement("span",t.key),this.inputElement.children[this.keyboardSelected]),this.selectChar(this.keyboardSelected+1)):this.inputElement.append(this.createElement("span",t.key));else{var e=this.inputElement.textContent;if(this.outputElement){var i="";this.prefixElement&&(i+=this.prefixElement.textContent),i+=e,this.printOutput(i),this.resetInput()}e&&(this.commandHistory.push(e),this.executeCommand(e))}},this.printOutput=function(t){this.outputElement.appendChild(this.createElement("p",t))},this.removeChar=function(t){-1===t&&(t=this.inputElement.children.length-1),this.inputElement.children[t]&&this.inputElement.removeChild(this.inputElement.children[t])},this.selectChar=function(t){null!==this.keyboardSelected&&this.inputElement.children[this.keyboardSelected]&&this.inputElement.children[this.keyboardSelected].classList.remove("shellui-highlight"),this.keyboardSelected=t,null!==this.keyboardSelected&&this.inputElement.children[this.keyboardSelected]?(this.endlineElement.style="display:none;",this.inputElement.children[this.keyboardSelected].classList.add("shellui-highlight")):this.endlineElement.style="display:auto;"},this.repeatCommand=function(t){if(this.currentHistory=t,this.commandHistory[this.currentHistory]){this.resetInput();var e;for(e=0;e<this.commandHistory[this.currentHistory].length;e++)this.inputElement.appendChild(this.createElement("span",this.commandHistory[this.currentHistory][e]))}},this.selectFromKeyboard=function(t){length=this.inputElement.children.length,length>0&&("left"===t?null===this.keyboardSelected?this.selectChar(length-1):this.keyboardSelected>0&&this.selectChar(this.keyboardSelected-1):"right"===t&&(null!==this.keyboardSelected&&this.keyboardSelected<length-1?this.selectChar(this.keyboardSelected+1):this.selectChar(null)))},this.selectCommandFromHistory=function(t){length=this.commandHistory.length,length>0&&("top"===t?null===this.currentHistory?this.repeatCommand(length-1):this.currentHistory>0&&this.repeatCommand(this.currentHistory-1):"bottom"===t&&(null!==this.currentHistory&&this.currentHistory<length-1?this.repeatCommand(this.currentHistory+1):this.repeatCommand(null)))},this.keyboardInteraction=function(t){switch(t.keyCode){case 8:null!==this.keyboardSelected?this.keyboardSelected>0&&(this.removeChar(this.keyboardSelected-1),this.selectChar(this.keyboardSelected-1)):this.removeChar(-1);break;case 37:this.selectFromKeyboard("left");break;case 39:this.selectFromKeyboard("right");break;case 38:this.selectCommandFromHistory("top");break;case 40:this.selectCommandFromHistory("bottom")}},"complete"===document.readyState?this.init():document.addEventListener("DOMContentLoaded",this.init.bind(this))},ShellUICommand=function(t,e,i){this.name=t,this.callback=e,this.options=i,void 0===this.options&&(this.options={}),this.execute=function(arguments){if(!0===this.options.async)this.callback.apply(this,arguments);else{var t=new CustomEvent("commandComplete",{detail:{returnContent:this.callback.apply(this,arguments)}});document.dispatchEvent(t)}}};